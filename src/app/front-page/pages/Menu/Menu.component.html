<navbar></navbar>
<!-- mapa -->
<div id="map" #map class="overflow-hidden w-full h-screen"></div>

<div
  class="absolute top-20 left-10 flex flex-col gap-6 z-10 max-h-[90vh] overflow-y-auto text-gray-800 font-sans"
>
  <!-- Mostrar info de medio ambiente -->
  <section
    class="bg-white rounded-2xl p-5 shadow-md border border-gray-200 w-[340px]"
  >
    <h3 class="text-lg font-semibold mb-2 flex items-center gap-2">
      Medio Ambiente
      <svg
        viewBox="0 0 22.617 22.592"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
      >
        <path
          d="M22.191,16.778a.993.993,0,0,0-.955-.128.989.989,0,0,0-.427-1.089c-.464-.356-1.17-.052-2.34.451a21.9,21.9,0,0,1-2.741,1.016,1.659,1.659,0,0,0-1.365-.708,19.22,19.22,0,0,1-2.711-.094V14.405h5.14A4.92,4.92,0,0,0,21.7,9.489a.343.343,0,0,0-.343-.343H15.878a4.908,4.908,0,0,0-4.226,2.423V5.259h5.14A4.92,4.92,0,0,0,21.7.343.344.344,0,0,0,21.361,0H15.878a4.92,4.92,0,0,0-4.912,4.916V7A4.908,4.908,0,0,0,6.74,4.573H1.257a.344.344,0,0,0-.343.343A4.919,4.919,0,0,0,5.826,9.832h5.14V16.1C8.655,15.182,9.5,14.788,3.254,14.72L.4,14.266a.347.347,0,0,0-.4.339v6.169a.342.342,0,0,0,.289.338l2.856.454c4.27,1.512,13.365,1.885,18.636-2.656C22.144,18.7,23.2,17.575,22.191,16.778ZM17.7,2.287c-1.809-.08-4.542.039-5.732,1.02a4.23,4.23,0,0,1,3.9-2.621H21a4.232,4.232,0,0,1-4.212,3.887H11.726c.351-.825,1.931-1.6,4.152-1.6H17.7A.343.343,0,0,0,17.7,2.287ZM5.826,9.146A4.234,4.234,0,0,1,1.613,5.259H6.74a4.231,4.231,0,0,1,3.9,2.622C9.458,6.9,6.719,6.779,4.911,6.86a.343.343,0,0,0,0,.685H6.738c2.222,0,3.8.776,4.152,1.6ZM2.882,20.829l-2.2-.348V15.007l2.2.348Zm13.066-3.151c1.553-.347,3.252-1.454,4.444-1.573,1.115.967-3.074,2.01-4.484,2.43A1.879,1.879,0,0,0,15.948,17.678Zm-.07-7.846H21a4.233,4.233,0,0,1-4.212,3.887H11.726c.351-.825,1.931-1.6,4.152-1.6H17.7a.343.343,0,0,0,0-.686c-1.808-.08-4.542.04-5.732,1.021A4.23,4.23,0,0,1,15.878,9.832Zm5.5,8.527c-7.008,5.56-16.238,3.1-17.806,2.621V15.406c4.68.021,5.458.479,6.146.883.707.414,1.316.772,4.676.717a.927.927,0,0,1,.9,1.159c0,.1-.053.437-.651.658-.641.251-2.053.465-5.145.064a.343.343,0,0,0-.088.681c3.546.807,8.42-.67,10.833-1.809.7-.3,1.364-.579,1.513-.455C22.243,17.674,21.6,18.173,21.373,18.359ZM1.783,16.19a.343.343,0,0,1,0,.686A.343.343,0,0,1,1.783,16.19Z"
          id="ecology"
        />
      </svg>
    </h3>

    <div class="mb-3">
      <p class="text-sm font-medium">Temperatura</p>
      <div class="w-full bg-gray-100 h-2 rounded-full mb-1">
        <div
          class="bg-red-400 h-2 rounded-full"
          [ngStyle]="{ width: (avgTemperature() || 0) * 2 + '%' }"
        ></div>
      </div>
      <p class="text-sm text-gray-600">
        {{ avgTemperature() | number : "1.1-1" }} °C
      </p>
    </div>

    <div class="mb-3">
      <p class="text-sm font-medium">Humedad</p>
      <div class="w-full bg-gray-100 h-2 rounded-full mb-1">
        <div
          class="bg-blue-400 h-2 rounded-full"
          [ngStyle]="{ width: avgHumidity() + '%' }"
        ></div>
      </div>
      <p class="text-sm text-gray-600">
        {{ avgHumidity() | number : "1.0-0" }}%
      </p>
    </div>
  </section>

  <!-- Mostrar info de trafico -->

  <section
    class="bg-white rounded-2xl p-5 shadow-md border border-gray-200 w-[340px]"
  >
    <h3 class="text-lg font-semibold mb-2 flex items-center gap-2">
      Trafico
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
      >
        <g fill="none">
          <path
            d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"
          />
          <path
            fill="currentColor"
            d="M15.84 4a3 3 0 0 1 2.499 1.34l.105.172L20.438 9H21.6a.4.4 0 0 1 .392.32L22 9.4v.475a.8.8 0 0 1-.502.743l-.128.04a5 5 0 0 1 .484 2.502l-.027.287l-.725 5.801a2 2 0 0 1-1.827 1.746l-.158.006H18a2 2 0 0 1-1.995-1.85L16 19H8a2 2 0 0 1-1.85 1.995L6 21H4.883a2 2 0 0 1-1.96-1.596l-.025-.156l-.725-5.8a5 5 0 0 1 .34-2.528l.117-.263l-.024-.005a.8.8 0 0 1-.599-.668L2 9.875V9.4a.4.4 0 0 1 .32-.392L2.4 9h1.163l1.993-3.488A3 3 0 0 1 7.96 4.007L8.16 4zm3.92 8.036a2.95 2.95 0 0 1-2 .957l-.206.007H6.446a2.96 2.96 0 0 1-2.205-.964a3 3 0 0 0-.103.928l.02.235L4.883 19H6v-1a1 1 0 0 1 .883-.993L7 17h10a1 1 0 0 1 .993.883L18 18v1h1.117l.725-5.801c.05-.392.02-.787-.083-1.163ZM5.737 13.898L8.48 15.38c.373.202.218.769-.206.752l-2.314-.093A1 1 0 0 1 5 15.04v-.7a.5.5 0 0 1 .738-.44Zm13.262.44v.701a1 1 0 0 1-.96 1l-2.314.092c-.424.017-.58-.55-.206-.752l2.742-1.48a.5.5 0 0 1 .738.44ZM15.84 6H8.16a1 1 0 0 0-.868.504l-1.714 3A1 1 0 0 0 6.446 11h11.108a1 1 0 0 0 .868-1.496l-1.714-3A1 1 0 0 0 15.839 6Z"
          />
        </g>
      </svg>
    </h3>
    <div class="mb-3">
      <p class="text-sm font-medium">Densidad</p>
      <p class="text-sm text-gray-600">{{ density() }} vehículos actuales</p>
    </div>

    <div class="mb-1">
      <p class="text-sm font-medium">Actuaciones</p>

      <p class="text-sm text-gray-600">{{ actions() }} registradas</p>
    </div>
  </section>
</div>

<!-- Filtro mostrar dispositivos traffic/environmental -->
<div
  class="absolute left-10 flex flex-col gap-6 z-10 max-h-[90vh] text-gray-800 font-sans"
  style="top: 500px"
>
  <section
    class="bg-white rounded-2xl p-5 shadow-md border border-gray-200 flex items-center gap-4"
  >
    Tipo:
    <select (change)="ChangeType($event)">
      <option value="">Todos</option>
      <option value="traffic">Tráfico</option>
      <option value="environmental">Medio ambiente</option>
    </select>
  </section>
</div>
<div
  class="absolute top-20 right-10 flex flex-col gap-6 z-10 max-h-[90vh] text-gray-800 font-sans"
>
  <section
    class="bg-white rounded-2xl p-5 shadow-md border border-gray-200 flex items-center gap-4"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 56 56"
    >
      <path
        fill="currentColor"
        d="M28 4c9.389 0 17 7 17 19c0 4.764-2.679 10.63-5.91 15.974l-.543.885q-.275.44-.551.874l-.558.861l-.28.425l-.561.839l-.563.82l-.56.803l-.556.782l-.55.76l-.542.735l-.531.71l-.519.682l-.749.97l-.708.898l-.66.822l-.207.256c-1.354 1.604-3.627 1.54-4.903 0l-.642-.794l-.692-.874l-.487-.623l-.503-.654l-.783-1.034l-.537-.723l-.546-.747l-.553-.771l-.559-.792l-.562-.812l-.562-.83q-.28-.42-.56-.847l-.558-.86l-.551-.875l-.543-.885C13.679 33.63 11 27.764 11 23c0-12 7.611-19 17-19m0 4c-7.622 0-13 5.682-13 15c0 3.345 1.746 7.812 4.61 12.747l.503.85l.523.859l.544.867l.279.436l.573.876l.592.883l.61.888l.627.892l.644.896l.328.45l.668.9l.605.799l.312.405a2 2 0 0 0 3.163 0l.568-.74l.676-.904l.661-.9l.645-.897l.629-.894l.61-.889q.302-.443.593-.884l.574-.877q.706-1.094 1.348-2.164l.502-.85C39.255 30.81 41 26.343 41 23c0-9.318-5.378-15-13-15m0 5a8 8 0 1 1 0 16a8 8 0 0 1 0-16m0 4a4 4 0 1 0 0 8a4 4 0 0 0 0-8"
      />
    </svg>

    <p class="text-lg font-semibold">{{ devices().length }}</p>
  </section>
</div>

<!-- Info breve del device -->

<div
  *ngIf="DataMarker()"
  class="absolute top-48 right-10 flex flex-col gap-4 z-10 max-h-[80vh] text-gray-800 font-sans"
>
  <section
    class="bg-white cursor-pointer rounded-xl p-3 shadow-sm border border-gray-200 max-w-60 text-sm"
  >
    <h3 class="text-base font-semibold flex items-center gap-6">
      Dispositivo:
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 100 100"
      >
        <path
          fill="currentColor"
          d="M50.002 0C28.103 0 10 17.008 10 37.932c0 8.061 2.712 15.566 7.268 21.71l25.996 36.194l.109.135c2.05 2.538 4.37 4.262 7.094 4.004c2.724-.26 4.491-2.142 6.156-4.28l.088-.11l28.732-39.937l.018-.03c.671-1.151 1.166-2.323 1.588-3.464A35.9 35.9 0 0 0 90 37.932C90 17.009 71.9 0 50.002 0m0 5.318c19.148 0 34.674 14.762 34.674 32.614c0 4.296-.9 8.395-2.531 12.168l-.03.068l-.027.07c-.362.986-.756 1.892-1.223 2.694l-.004.007L52.37 92.484c-1.327 1.683-2.261 2.18-2.408 2.194s-.854-.126-2.371-1.973l-25.9-36.033l-.075-.1c-3.968-5.313-6.29-11.726-6.29-18.64c0-17.851 15.529-32.614 34.677-32.614"
          color="currentColor"
        />
        <path
          fill="currentColor"
          d="M50.04 12.432q-3.4 0-5.772 2.373q-2.295 2.293-2.295 5.615t2.373 5.693t5.693 2.371t5.615-2.37q2.373-2.373 2.373-5.694t-2.373-5.615q-2.293-2.373-5.615-2.373m3.89 20.832c.246 0-.49.037-.72.109l-15.448 3.65c-.967.309-1.44 1.17-1.063 1.934l.582 1.174c.379.765 1.47 1.149 2.45.861c.969-.285 1.716-.394 2.15-.394c.4 0 .449.057.451.058l.059.037c-.115-.072.09.089.232.567c.576 5.733.336 7.126.336 13.492c0 1.765-.307 2.955-.402 3.115l-.02.037c-.236.429-.459.595-.682.694c.056-.025-1.063.228-2.792.228c-1.055 0-1.91.672-1.91 1.5V61.5c0 .828.855 1.5 1.91 1.5H61.52c1.055 0 1.909-.672 1.909-1.5v-1.174c0-.828-.854-1.5-1.909-1.5c-1.65 0-2.697-.228-2.785-.264c-.294-.137-.512-.325-.722-.666c-.08-.165-.35-1.363-.35-3.144V34.764c0-.829-.856-1.5-1.91-1.5z"
        />
      </svg>
    </h3>

    <p class="font-medium">{{ DataMarker()?.description }}</p>
    <p class="font-medium mt-1">Tipo: {{ DataMarker()?.type | titlecase }}</p>
  </section>
</div>
